---
import SpotlightLayout from './SpotlightLayout.astro';

export interface Props {
  title?: string;
  subtitle?: string;
  author: string;
  date: Date;
  tags: string[];
  header_img?: string;
  description?: string;
  lang: 'zh' | 'en';
  gallery?: Array<{ src: string; alt?: string; caption?: string; width?: number; height?: number }>;
  camera?: { model?: string; lens?: string; settings?: string };
  location?: string;
  publishedDate?: string;
}

const { title, subtitle, date, tags, header_img, description, lang, gallery, camera, location } = Astro.props;
const cover = header_img || gallery?.[0]?.src;
---

<SpotlightLayout title={`${title} | Joey's Notes`} description={description || subtitle || title} image={cover} lang={lang}>
  <article class="section-gap">
    <div class="shell">
      <div class="mx-auto max-w-4xl">
        <a href="/photography/" class="text-sm muted hover:text-[var(--text)]">← 返回摄影列表</a>

        <header class="mt-6 border-b pb-8" style="border-color: var(--line);">
          <p class="text-xs muted">
            {date.toLocaleDateString(lang === 'zh' ? 'zh-CN' : 'en-US')}
            {location ? ` · ${location}` : ''}
          </p>
          {title && <h1 class="mt-4 text-4xl font-semibold sm:text-5xl" style="font-family: var(--font-serif);">{title}</h1>}
          {subtitle && <p class="mt-3 text-lg muted">{subtitle}</p>}

          {(camera?.model || camera?.lens || camera?.settings) && (
            <div class="mt-5 space-y-1 text-sm muted">
              {camera?.model && <p>相机：{camera.model}</p>}
              {camera?.lens && <p>镜头：{camera.lens}</p>}
              {camera?.settings && <p>参数：{camera.settings}</p>}
            </div>
          )}

          {tags.length > 0 && (
            <div class="mt-5 flex flex-wrap gap-2">
              {tags.map((tag) => (
                <span class="rounded-full border px-2.5 py-1 text-xs muted" style="border-color: var(--line);">{tag}</span>
              ))}
            </div>
          )}
        </header>

        {gallery && gallery.length > 0 && (
          <section class="mt-10 grid grid-cols-1 gap-8 sm:grid-cols-2">
            {gallery.map((photo, index) => (
              <figure>
                <img src={photo.src} alt={photo.alt || `Photo ${index + 1}`} class="w-full rounded-xl object-cover" loading={index < 2 ? 'eager' : 'lazy'} decoding="async" />
                {photo.caption && <figcaption class="mt-2 text-sm muted">{photo.caption}</figcaption>}
              </figure>
            ))}
          </section>
        )}

        <div class="prose prose-lg mt-10">
          <slot />
        </div>
      </div>
    </div>
  </article>
</SpotlightLayout>
