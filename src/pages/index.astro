---
import { getCollection } from 'astro:content';
import SpotlightLayout from '../layouts/SpotlightLayout.astro';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const sorted = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const latestArticles = sorted.filter((p) => p.data.type !== 'photography').slice(0, 6);
const latestPhotos = sorted.filter((p) => p.data.type === 'photography').slice(0, 4);

const description = '以简洁排版记录软件工程实践与摄影观察。';
---

<SpotlightLayout title="Joey's Notes | 黄药师的笔记本" description={description}>
  <section class="section-gap">
    <div class="shell">
      <div class="hero-intro">
        <p class="eyebrow">Notebook</p>
        <h1 class="mt-4 text-4xl font-semibold tracking-tight sm:text-6xl">
          技术写作与摄影归档
        </h1>
        <p class="mt-6 text-lg muted">
          保持克制的视觉、稳定的阅读节奏。文章强调可复用经验，摄影页面强调作品展示。
        </p>
      </div>
    </div>
  </section>

  <section class="section-gap">
    <div class="shell">
      <div class="section-head">
        <h2 class="text-2xl font-semibold">最新文章</h2>
        <a href="/articles/" class="text-sm muted hover:text-[var(--text)]">查看全部</a>
      </div>

      <div class="entry-stream">
        {latestArticles.map((post) => (
          <article class="entry-item">
            <time class="entry-meta" datetime={post.data.date.toISOString()}>
              {post.data.date.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <h3 class="entry-title">
              <a href={`/posts/${post.slug}/`}>{post.data.title}</a>
            </h3>
            <p class="entry-desc">{post.data.description || post.data.subtitle || '点击查看完整内容。'}</p>
          </article>
        ))}
      </div>
    </div>
  </section>

  <section class="section-gap">
    <div class="shell">
      <div class="section-head">
        <h2 class="text-2xl font-semibold">近期摄影</h2>
        <a href="/photography/" class="text-sm muted hover:text-[var(--text)]">浏览归档</a>
      </div>

      <div class="photo-grid mx-auto mt-6 grid max-w-[52rem] grid-cols-2 gap-4 sm:grid-cols-4">
        {latestPhotos.map((photo) => {
          const image = photo.data.gallery?.[0]?.src;
          if (!image) return null;
          return (
            <a href={`/posts/${photo.slug}/`} class="block overflow-hidden rounded-xl">
              <img src={image} alt={photo.data.title || '摄影作品'} class="aspect-[4/5] w-full object-cover" loading="lazy" decoding="async" />
            </a>
          );
        })}
      </div>
    </div>
  </section>
</SpotlightLayout>
