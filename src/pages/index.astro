---
import { getCollection } from 'astro:content';
import SpotlightLayout from '../layouts/SpotlightLayout.astro';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const sorted = posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
const latest = sorted.slice(0, 8);
const articleCount = sorted.filter((p) => p.data.type !== 'photography').length;
const photoCount = sorted.filter((p) => p.data.type === 'photography').length;

const description = '以简洁排版记录软件工程实践与摄影观察。';
---

<SpotlightLayout title="Joey's Notes | 黄药师的笔记本" description={description}>
  <section class="section-gap">
    <div class="shell">
      <div class="max-w-3xl">
        <p class="eyebrow">Notebook</p>
        <h1 class="mt-4 text-4xl font-semibold tracking-tight sm:text-6xl" style="font-family: var(--font-serif);">
          简洁、留白、可读
        </h1>
        <p class="mt-6 text-lg muted">
          这里聚焦两件事：把技术经验写清楚，把摄影作品展示干净。尽量减少视觉负担，让阅读本身更自然。
        </p>
        <div class="mt-7 flex flex-wrap gap-3 text-sm">
          <a href="/articles/" class="rounded-full border px-4 py-2 hover:bg-black/5 dark:hover:bg-white/10" style="border-color: var(--line);">阅读文章</a>
          <a href="/photography/" class="rounded-full border px-4 py-2 hover:bg-black/5 dark:hover:bg-white/10" style="border-color: var(--line);">浏览摄影</a>
        </div>
      </div>

      <div class="mt-10 grid gap-4 sm:grid-cols-2">
        <div class="soft-panel p-5">
          <p class="eyebrow">内容规模</p>
          <p class="mt-3 text-3xl font-semibold">{articleCount} 篇文章</p>
          <p class="muted mt-1">工程实践、排障记录、工具沉淀</p>
        </div>
        <div class="soft-panel p-5">
          <p class="eyebrow">视觉归档</p>
          <p class="mt-3 text-3xl font-semibold">{photoCount} 组摄影</p>
          <p class="muted mt-1">更克制的作品浏览体验</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section-gap">
    <div class="shell">
      <div class="flex items-end justify-between">
        <h2 class="text-2xl font-semibold" style="font-family: var(--font-serif);">最近更新</h2>
        <a href="/articles/" class="text-sm muted hover:text-[var(--text)]">查看全部</a>
      </div>

      <div class="article-list mt-6 space-y-8">
        {latest.map((post) => (
          <article class="border-b pb-6" style="border-color: var(--line);">
            <time class="text-xs muted" datetime={post.data.date.toISOString()}>
              {post.data.date.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
            <h3 class="mt-2 text-xl font-semibold">
              <a href={`/posts/${post.slug}/`}>{post.data.title}</a>
            </h3>
            <p class="mt-2 muted">{post.data.description || post.data.subtitle || '点击查看完整内容。'}</p>
          </article>
        ))}
      </div>
    </div>
  </section>
</SpotlightLayout>
