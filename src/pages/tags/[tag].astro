---
import { getCollection } from 'astro:content';
import SpotlightLayout from '../../layouts/SpotlightLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => !data.draft);
  const tags = [...new Set(posts.flatMap((post) => post.data.tags))];

  return tags.map((tag) => ({
    params: { tag },
    props: {
      posts: posts
        .filter((post) => post.data.tags.includes(tag))
        .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()),
      tag,
    },
  }));
}

const { posts, tag } = Astro.props;
---

<SpotlightLayout title={`标签: ${tag} | Joey's Notes`} description={`查看所有标记为 "${tag}" 的文章`}>
  <section class="section-gap">
    <div class="shell">
      <div class="hero-intro">
        <p class="eyebrow">Tag</p>
        <h1 class="mt-4 text-4xl font-semibold">#{tag}</h1>
        <p class="mt-4 muted">共 {posts.length} 篇相关文章</p>
      </div>

      <div class="entry-stream mt-10">
        {posts.map((post) => (
          <article class="entry-item">
            <time class="entry-meta" datetime={post.data.date.toISOString()}>
              {new Date(post.data.date).toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
            </time>
            <h2 class="entry-title">
              <a href={`/posts/${post.slug}/`}>{post.data.title}</a>
            </h2>
            <p class="entry-desc">{post.data.description || post.data.subtitle || '点击查看完整内容。'}</p>
          </article>
        ))}
      </div>

      <div class="content-narrow mt-10">
        <a href="/tags/" class="text-sm muted hover:text-[var(--text)]">← 查看所有标签</a>
      </div>
    </div>
  </section>
</SpotlightLayout>
