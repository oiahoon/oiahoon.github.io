---
import { getCollection } from 'astro:content';
import SpotlightLayout from '../../layouts/SpotlightLayout.astro';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const tagCounts = new Map();
posts.forEach((post) => {
  post.data.tags.forEach((tag) => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

const sortedTags = Array.from(tagCounts.entries()).sort(([, a], [, b]) => b - a);
---

<SpotlightLayout title="标签 | Joey's Notes" description="按标签浏览文章，快速找到感兴趣的技术主题和内容分类。" lang="zh">
  <section class="section-gap">
    <div class="shell">
      <div class="mx-auto max-w-4xl text-center">
        <p class="eyebrow">Tags</p>
        <h1 class="mt-4 text-4xl font-semibold">文章标签</h1>
        <p class="mt-4 muted">共 {sortedTags.length} 个标签，{posts.length} 篇文章。选择一个标签继续阅读。</p>
      </div>

      <div class="mx-auto mt-10 max-w-5xl">
        <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3">
          {sortedTags.map(([tag, count]) => (
            <a href={`/tags/${tag}/`} class="soft-panel group flex items-center justify-between px-4 py-3 transition hover:border-[var(--accent)]">
              <span class="text-sm font-medium">#{tag}</span>
              <span class="text-xs muted">{count} 篇</span>
            </a>
          ))}
        </div>
      </div>
    </div>
  </section>
</SpotlightLayout>
