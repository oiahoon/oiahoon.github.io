---
import { getCollection } from 'astro:content';
import SpotlightLayout from '../layouts/SpotlightLayout.astro';
import { getPreviewImage } from '../utils/extractFirstImage';

const photos = await getCollection('posts', ({ data }) => !data.draft && data.type === 'photography');
const sorted = photos.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());
---

<SpotlightLayout title="摄影作品 | Joey's Notes" description="摄影归档" lang="zh">
  <section class="section-gap">
    <div class="shell">
      <div class="mx-auto max-w-3xl text-center">
        <p class="eyebrow">Photography</p>
        <h1 class="mt-4 text-4xl font-semibold" style="font-family: var(--font-serif);">摄影作品</h1>
        <p class="mt-4 muted">更少元素、更大留白，让照片本身成为主角。</p>
      </div>

      <div class="photo-grid mx-auto mt-10 grid max-w-4xl grid-cols-1 gap-8 sm:grid-cols-2">
        {sorted.map((photo) => {
          const image = photo.data.gallery?.[0]?.src || getPreviewImage(photo);
          if (!image) return null;
          return (
            <article>
              <a href={`/posts/${photo.slug}/`} class="block overflow-hidden rounded-xl">
                <img src={image} alt={photo.data.title || '摄影作品'} class="aspect-[4/5] w-full object-cover" loading="lazy" decoding="async" />
              </a>
              <h2 class="mt-3 text-lg font-semibold"><a href={`/posts/${photo.slug}/`}>{photo.data.title || '未命名作品'}</a></h2>
              <p class="mt-1 text-sm muted">{photo.data.date.toLocaleDateString('zh-CN')}</p>
            </article>
          );
        })}
      </div>
    </div>
  </section>
</SpotlightLayout>
